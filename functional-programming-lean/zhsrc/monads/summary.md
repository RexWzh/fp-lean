# 摘要

## 编码副作用

Lean是一种纯函数式语言。
这意味着它不包括可变变量、日志记录或异常等副作用。
然而，大多数副作用可以使用函数和归纳类型或结构的组合进行_编码_。
例如，可变状态可以被编码为从初始状态到最终状态和结果的函数，异常可以被编码为具有成功终止和错误构造函数的归纳类型。

每个编码效果集都是一种类型。
因此，如果程序使用这些编码效果，那么这在其类型中是明显的。
函数式编程并不意味着程序不能使用效果，只是要求它们对使用的效果是*诚实的*。
Lean的类型签名不仅描述函数期望的参数类型和返回的结果类型，还描述它可能使用的效果。

## Monad类型类

在允许在任何地方使用效果的语言中，可以编写纯函数式程序。
例如，`2 + 3`是一个有效的Python程序，它根本没有效果。
类似地，组合具有效果的程序需要一种方法来说明效果必须发生的顺序。
毕竟，在修改变量之前或之后抛出异常是有区别的。

类型类`Monad`捕捉了这两个重要的属性。
它有两个方法：`pure`表示没有效果的程序，`bind`用于序列化有副作用的程序。
`Monad`实例的契约确保`bind`和`pure`实际上捕获了纯计算和顺序。

## 对于Monad的`do`表示法

`do`表示法不仅适用于`IO`，也适用于任何monad。
它允许使用monads的程序以类似于语句导向语言的风格编写，其中语句按顺序进行。
此外，`do`表示法还提供了许多其他方便的简写，例如嵌套操作。
使用`do`编写的程序在幕后被转换为`>>=`的应用。

## 自定义Monads

不同的语言提供不同的副作用集。
虽然大多数语言都提供可变变量和文件I/O，但并非所有语言都具有异常之类的功能。
其他语言提供罕见或独特的效果，例如Icon的基于搜索的程序执行、Scheme和Ruby的延续以及Common Lisp的可恢复异常。
使用单子来编码效果的一个优势是，程序不仅限于语言提供的效果集合。
由于 Lean 设计用于方便地使用任何单子进行编程，程序员可以自由选择适合于任何特定应用的一组副作用。

## `IO` 单子

能够影响实际世界的程序在 Lean 中被写成 `IO` 动作。
`IO` 是众多单子中的一个。
`IO` 单子编码了状态和异常，其中状态用于跟踪世界的状态，而异常模拟了失败和恢复。